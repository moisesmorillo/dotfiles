# --- TERMINAL & SYSTEM SETTINGS ---
# Use tmux-256color internally for best compatibility with Neovim/LazyVim
set -g default-terminal "tmux-256color"

# Ghostty/Modern Terminal Fixes: Enable TrueColor (RGB) and Extended Keys
# This allows <Esc> to work instantly in Terminal mode
set -as terminal-features ",xterm-256color:RGB:extkeys"

# Keep your shell and macOS namespace settings
set -g default-shell $SHELL
set -g default-command "reattach-to-user-namespace $SHELL"

# --- INTERFACE & INPUT ---
set -g mouse on
set -g set-clipboard on
setw -g mode-keys vi

# Cursor shape switching: bar (insert) ↔ block (normal)
# Enables proper cursor shape changes in Neovim within Ghostty/modern terminals
set -g cursor-style bar
set -ag terminal-overrides ',*:Ss=\E[%p1%d q:Se=\E[2 q'

# Hyper+a Prefix (mapped via Karabiner: Caps Lock → Ctrl-Meta-Shift-Super)
unbind C-b
set -g prefix 'C-M-s-S-a'
bind 'C-M-s-S-a' send-prefix

# --- WINDOW & PANE MANAGEMENT ---
set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on
set -g status-interval 1

# New window: open in current directory and name it after the directory
bind c new-window -c "#{pane_current_path}" -n "#{b:pane_current_path}"
set-hook -g after-new-window 'rename-window "#{b:pane_current_path}"'

# Navigation & Resizing
bind h select-pane -L
bind j select-pane -D 
bind k select-pane -U
bind l select-pane -R
bind -n S-Left previous-window
bind -n S-Right next-window
bind -n M-Up resize-pane -U 5
bind -n M-Down resize-pane -D 5
bind -n M-Left resize-pane -L 5
bind -n M-Right resize-pane -R 5

# Splits
unbind %
unbind '"'
bind - split-window -v -c "#{pane_current_path}"
bind | split-window -h -c "#{pane_current_path}"

# --- POPUPS & TOOLS ---
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded!"
bind g display-popup -E -B -d "#{pane_current_path}" -w "100%" -h "100%" lazygit
unbind w
bind w display-popup -E -B -h "100%" -w "100%" "~/.config/tmux/tmux-window-manager.sh"
bind S display-popup -w "40%" -h "20%" -E "~/.config/tmux/tmux-session-create.sh"

# --- COPY MODE ---
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# --- PLUGINS ---
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible' # Sets escape-time 0 automatically
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'rose-pine/tmux'

set -g @rose_pine_variant 'main'
set -g @continuum-restore 'on'

# Run TPM last
run '~/.tmux/plugins/tpm/tpm'
